<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shixiang Wang">
<meta name="author" content="Yankun Zhao">
<meta name="dcterms.date" content="2024-12-04">

<title>Methods – ImmunoFusion</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-2ae6fbf89ff930ae2f5365102313bf40.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">ImmunoFusion</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Tutorial</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./methods.html" aria-current="page"> 
<span class="menu-text">Supplementary Methods</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#gene-fusions-identification-and-differential-expression-analysis" id="toc-gene-fusions-identification-and-differential-expression-analysis" class="nav-link active" data-scroll-target="#gene-fusions-identification-and-differential-expression-analysis">Gene Fusions identification and differential expression analysis</a></li>
  <li><a href="#response-and-response2" id="toc-response-and-response2" class="nav-link" data-scroll-target="#response-and-response2">Response and Response2</a></li>
  <li><a href="#cancer-type-abbreviation" id="toc-cancer-type-abbreviation" class="nav-link" data-scroll-target="#cancer-type-abbreviation">Cancer Type Abbreviation</a></li>
  <li><a href="#clinical-data-preprocessing" id="toc-clinical-data-preprocessing" class="nav-link" data-scroll-target="#clinical-data-preprocessing">Clinical data preprocessing</a>
  <ul class="collapse">
  <li><a href="#tcga" id="toc-tcga" class="nav-link" data-scroll-target="#tcga">TCGA</a></li>
  <li><a href="#cptac" id="toc-cptac" class="nav-link" data-scroll-target="#cptac">CPTAC</a></li>
  <li><a href="#target" id="toc-target" class="nav-link" data-scroll-target="#target">TARGET</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Methods</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Shixiang Wang </p>
             <p>Yankun Zhao </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 4, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="gene-fusions-identification-and-differential-expression-analysis" class="level2">
<h2 class="anchored" data-anchor-id="gene-fusions-identification-and-differential-expression-analysis">Gene Fusions identification and differential expression analysis</h2>
<p>We employed two Gene Fusions(GFs) detection tools, including arriba, STAR-Fusion, to identify, parse, and annotate GFs junctions within each sample, using the human genome version hg38 as the reference. In our pursuit of biologically robust GFs identification within each cohort, we undertook an approach metafusion that amalgamated results from two GFs detection tools. Firstly, we exclusively retained Fusions located on chromosomes 1 to 22, as well as the X and Y chromosomes. Secondly, GFs were mandated to exhibit genomic overlap with gene regions as defined in the reference genome annotation file, specifically “gencode.v34.annotation.gtf.”. Thirdly to ensure the precision and recall in GFs prediction with different tools, one can either rely on consensus predictions or all predctions and choosing junction-crossing reads and reads mates which flank (span) the breakpoint. Fourthly, we offer FusionAnnotator to identify and prioritize GFs that have been previously reported in cancer or normal samples. Lastly, the detected data can be divided into Cis-SAGes and other categories to further explore the debate on what should be considered true fusion RNAs. This meticulous methodological approach was instrumental in ensuring the acquisition of biologically sound and reliable GFs datasets, thereby fortifying the integrity of our analysis within each cohort. This analysis facilitated comparisons between patient groups, such as those who responded to checkpoint immunotherapy versus non-responders, as well as between samples collected before and during ICB treatment.</p>
</section>
<section id="response-and-response2" class="level2">
<h2 class="anchored" data-anchor-id="response-and-response2">Response and Response2</h2>
<p>We gathered and processed patient ‘Response’ data from various cohorts. However, due to inconsistencies among these cohorts, such as the usage of different terms like CR, PR, SD, PD, R, NR, DCB, and NDB, we harmonized the response variable based on the timing of treatment and treatment response. As a result, we introduced a new variable called ‘Response2’ with four distinct categories: Pre-R, Pre-NR, On-R, and On-NR. In cases where response data was not available, we assigned the category NE.</p>
</section>
<section id="cancer-type-abbreviation" class="level2">
<h2 class="anchored" data-anchor-id="cancer-type-abbreviation">Cancer Type Abbreviation</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Abbr.</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BLCA</td>
<td style="text-align: left;">Bladder urothelial carcinoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">SKCM</td>
<td style="text-align: left;">Skin cutaneous melanoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">KIRC &amp; CCRCC</td>
<td style="text-align: left;">Kidney renal clear cell carcinoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">HNSC &amp; HNSCC</td>
<td style="text-align: left;">Head and neck squamous cell carcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NSCLC</td>
<td style="text-align: left;">Non-small cell lung cancer, including lung adenocarcinoma and lung squamous cell carcinoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">SCLC</td>
<td style="text-align: left;">Small cell lung cancer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SARC</td>
<td style="text-align: left;">Sarcoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">BRCA</td>
<td style="text-align: left;">Breast cancer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GBM</td>
<td style="text-align: left;">Glioblastoma Multiforme</td>
</tr>
<tr class="even">
<td style="text-align: left;">STAD</td>
<td style="text-align: left;">Stomach Adenocarcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SGC</td>
<td style="text-align: left;">Salivary gland cancer</td>
</tr>
<tr class="even">
<td style="text-align: left;">LUSC</td>
<td style="text-align: left;">Lung Squamous Cell Carcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MESO</td>
<td style="text-align: left;">Mesothelioma</td>
</tr>
<tr class="even">
<td style="text-align: left;">PCPG</td>
<td style="text-align: left;">Pheochromocytoma and Paraganglioma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LIHC</td>
<td style="text-align: left;">Liver Hepatocellular Carcinoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">PRAD</td>
<td style="text-align: left;">Prostate Adenocarcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACC</td>
<td style="text-align: left;">Adrenocortical Carcinoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">TGCT</td>
<td style="text-align: left;">Testicular Germ Cell Tumors</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PAAD</td>
<td style="text-align: left;">Pancreatic Adenocarcinoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">UCEC</td>
<td style="text-align: left;">Uterine Corpus Endometrial Carcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">THCA</td>
<td style="text-align: left;">Thyroid carcinoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">CESC</td>
<td style="text-align: left;">Cervical squamous cell carcinoma and endocervical adenocarcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ESCA</td>
<td style="text-align: left;">Esophageal carcinoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">READ</td>
<td style="text-align: left;">Rectum adenocarcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OV</td>
<td style="text-align: left;">Ovarian Serous Cystadenocarcinoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">CHOL</td>
<td style="text-align: left;">Cholangiocarcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UCS</td>
<td style="text-align: left;">Uterine Carcinosarcoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">LUAD</td>
<td style="text-align: left;">Lung Adenocarcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LGG</td>
<td style="text-align: left;">Brain Lower Grade Glioma</td>
</tr>
<tr class="even">
<td style="text-align: left;">HGSC</td>
<td style="text-align: left;">High-Grade Serous Carcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LSCC</td>
<td style="text-align: left;">Lung Squamous Cell Carcinoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">PDAC</td>
<td style="text-align: left;">Pancreatic Ductal Adenocarcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">THYM</td>
<td style="text-align: left;">Thymoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">KICH</td>
<td style="text-align: left;">Kidney Chromophobe</td>
</tr>
<tr class="odd">
<td style="text-align: left;">KIRP</td>
<td style="text-align: left;">Kidney Renal Papillary Cell Carcinoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">COAD</td>
<td style="text-align: left;">Colon Adenocarcinoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LAML &amp; AML</td>
<td style="text-align: left;">Acute Myeloid Leukemia</td>
</tr>
<tr class="even">
<td style="text-align: left;">DLBC</td>
<td style="text-align: left;">Lymphoid Neoplasm Diffuse Large B-cell Lymphoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ALL</td>
<td style="text-align: left;">Acute lymphocytic leukemia</td>
</tr>
<tr class="even">
<td style="text-align: left;">AML-IF</td>
<td style="text-align: left;">Acute Myeloid Leukemia, Induction Failure Subproject</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NBL</td>
<td style="text-align: left;">Neuroblastoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">OS</td>
<td style="text-align: left;">Osteosarcoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ES</td>
<td style="text-align: left;">Ewing sarcoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT</td>
<td style="text-align: left;">Wilms tumor</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CCSK</td>
<td style="text-align: left;">Clear Cell Sarcoma of the Kidney</td>
</tr>
<tr class="even">
<td style="text-align: left;">RT</td>
<td style="text-align: left;">Kidney, Rhabdoid Tumor</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CCSK</td>
<td style="text-align: left;">CNS, ependymoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">MRT</td>
<td style="text-align: left;">CNS, rhabdoid tumor</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CCSK</td>
<td style="text-align: left;">CNS, medulloblastoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCSK</td>
<td style="text-align: left;">NHL, anaplastic large cell lymphoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CCSK</td>
<td style="text-align: left;">NHL, Burkitt lymphoma (BL)</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCSK</td>
<td style="text-align: left;">Rhabdomyosarcoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CCSK</td>
<td style="text-align: left;">Soft tissue sarcoma, non-rhabdomyosarcoma</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCSK</td>
<td style="text-align: left;">CNS, other</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B-ALL</td>
<td style="text-align: left;">Precursor B-cell lymphoblastic leukemia</td>
</tr>
<tr class="even">
<td style="text-align: left;">GNB</td>
<td style="text-align: left;">Ganglioneuroblastoma</td>
</tr>
</tbody>
</table>
</section>
<section id="clinical-data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="clinical-data-preprocessing">Clinical data preprocessing</h2>
<section id="tcga" class="level3">
<h3 class="anchored" data-anchor-id="tcga">TCGA</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load("/home/data2/Projects/Fusion/unclean/TCGA_ALL_clinical.rdata")</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># TCGA_ALL_clinical |&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(Patient_ID = bcr_patient_barcode,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#          Age = age_at_initial_pathologic_diagnosis,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#          Sex = gender,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#          Race = race,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#          )</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># [Discrepancy] [Not Applicable]  [Not Available]</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># [Discrepancy] [Not Available]       [Unknown]</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># # [Discrepancy]                                        [Not Applicable]</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 29                                                     105</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># [Not Available]                                         [Not Evaluated]</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 5140                                                       4</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># [Unknown]</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(UCSCXenaShiny)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(tcga_clinical_fine<span class="sc">$</span>Stage_ajcc)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>tcga_clinical</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>tcga_clinical_fine</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>tcga_genome_instability</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>tcga_purity</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>tcga_subtypes</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>tcga_surv</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(tcga_clinical_fine)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">unique</span>(tcga_clinical_fine))</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>tcga_clinical <span class="ot">=</span> <span class="fu">unique</span>(tcga_clinical_fine) <span class="sc">|&gt;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tcga_surv, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Sample"</span><span class="ot">=</span><span class="st">"sample"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tcga_purity, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Sample"</span><span class="ot">=</span><span class="st">"sample"</span>))</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>tcga_clinical[<span class="dv">551</span>, ]<span class="sc">$</span>Sample</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">startsWith</span>(tcga_genome_instability<span class="sc">$</span>sample, <span class="st">"TCGA"</span>))</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>tcga_clinical <span class="ot">=</span> tcga_clinical <span class="sc">|&gt;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tcga_genome_instability[<span class="fu">startsWith</span>(tcga_genome_instability<span class="sc">$</span>sample, <span class="st">"TCGA"</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">duplicated</span>(tcga_genome_instability<span class="sc">$</span>sample), ],  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Sample"</span><span class="ot">=</span><span class="st">"sample"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#left_join(tcga_genome_instability[duplicated(tcga_genome_instability$sample), ],  by = c("Sample"="sample")) |&gt;</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tcga_subtypes,  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Sample"</span><span class="ot">=</span><span class="st">"sampleID"</span>))</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(tcga_clinical<span class="sc">$</span>Sample))</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">duplicated</span>(tcga_clinical<span class="sc">$</span>Sample))</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>tcga_clinical[<span class="fu">duplicated</span>(tcga_clinical<span class="sc">$</span>Sample), ]<span class="sc">$</span>Sample</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>tcga_clinical.final <span class="ot">=</span> tcga_clinical[<span class="sc">!</span><span class="fu">duplicated</span>(tcga_clinical<span class="sc">$</span>Sample), ] <span class="sc">|&gt;</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Sample_ID =</span> Sample, <span class="at">Sex =</span> Gender, <span class="at">OS_Time =</span> OS.time, <span class="at">OS_Status =</span> OS, <span class="at">DSS_Time =</span> DSS.time, <span class="at">DSS_Status =</span> DSS, <span class="at">DFS_Time =</span> DFI.time, <span class="at">DFS_Status =</span> DFI, <span class="at">PFS_Time =</span> PFI.time, <span class="at">PFS_Status =</span> PFI) <span class="sc">|&gt;</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cancer_type) <span class="sc">|&gt;</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sex =</span> <span class="fu">ifelse</span>(Sex <span class="sc">==</span> <span class="st">"FEMALE"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>),</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>         <span class="at">Patient_ID =</span> <span class="fu">substr</span>(Sample_ID, <span class="dv">1</span>, <span class="dv">12</span>))</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(tcga_clinical.final<span class="sc">$</span>Sample_ID))</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(tcga_clinical.final<span class="sc">$</span>Cancer))</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">duplicated</span>(tcga_clinical.final<span class="sc">$</span>Sample_ID))</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>tcga_clinical.final <span class="ot">=</span> tcga_clinical.final <span class="sc">|&gt;</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Patient_ID, Sample_ID, <span class="fu">everything</span>()) <span class="sc">|&gt;</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.table</span>()</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>tcga_clinical.final</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(tcga_clinical.final, <span class="at">file =</span> <span class="st">"/home/data2/Projects/Fusion/fusiondb/Clininfo/TCGA_info.tsv"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cptac" class="level3">
<h3 class="anchored" data-anchor-id="cptac">CPTAC</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Clinical data from CPTAC paper ------------------------------------------</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>cli_list <span class="ot">=</span> fs<span class="sc">::</span><span class="fu">dir_ls</span>(<span class="st">"CPTAC_Clinical_meta_data_v1/"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>cli <span class="ot">=</span> purrr<span class="sc">::</span><span class="fu">map</span>(cli_list, fread) <span class="sc">|&gt;</span> <span class="fu">rbindlist</span>(<span class="at">fill =</span> <span class="cn">TRUE</span>, <span class="at">use.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cli)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 问题，这个第 2 行要跳过才行</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 另外这个同时包含 CPTAC-2/3 的样本，但总数少一些</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>cli2 <span class="ot">=</span> purrr<span class="sc">::</span><span class="fu">map</span>(cli_list, <span class="cf">function</span>(x) {</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 由于列名也不同，这里读两次，一次读 colname，一次读数据</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  data1 <span class="ot">=</span> <span class="fu">fread</span>(x)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  data2 <span class="ot">=</span> <span class="fu">fread</span>(x, <span class="at">skip =</span> <span class="dv">2</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 更新列名</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(data2) <span class="ot">=</span> <span class="fu">colnames</span>(data1)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  data2<span class="sc">$</span>Cancer <span class="ot">=</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="fu">basename</span>(x), <span class="st">"_meta.txt"</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  data2 <span class="sc">|&gt;</span> <span class="fu">as.data.table</span>()</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> <span class="fu">rbindlist</span>(<span class="at">fill =</span> <span class="cn">TRUE</span>, <span class="at">use.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#colnames(cli2) = colnames(cli)</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cli2)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>cli2[Tumor <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">&amp;</span> Normal <span class="sc">==</span> <span class="st">"Yes"</span>] <span class="co"># 这个是标记患者是否同时 tumor / normal sample</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>cli_list2 <span class="ot">=</span> fs<span class="sc">::</span><span class="fu">dir_ls</span>(<span class="st">"meta_data_BCM/"</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>cli3 <span class="ot">=</span> purrr<span class="sc">::</span><span class="fu">map</span>(cli_list2, <span class="cf">function</span>(x) {</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 由于列名也不同，这里读两次，一次读 colname，一次读数据</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  data1 <span class="ot">=</span> <span class="fu">fread</span>(x)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  data2 <span class="ot">=</span> <span class="fu">fread</span>(x, <span class="at">skip =</span> <span class="dv">2</span>, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 更新列名</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(data2) <span class="ot">=</span> <span class="fu">colnames</span>(data1)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  data2<span class="sc">$</span>Cancer <span class="ot">=</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="fu">basename</span>(x), <span class="st">"_meta.txt"</span>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  data2 <span class="sc">|&gt;</span> <span class="fu">as.data.table</span>()</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> <span class="fu">rbindlist</span>(<span class="at">fill =</span> <span class="cn">TRUE</span>, <span class="at">use.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cli3)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(cli2, cli3)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">sort</span>(<span class="fu">colnames</span>(cli2)), <span class="fu">sort</span>(<span class="fu">colnames</span>(cli3)))</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>cli4 <span class="ot">=</span> cli3[, <span class="fu">colnames</span>(cli2), with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(cli2, cli4)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(cli2, cli4)</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">setdiff</span>(cli2, cli4) <span class="sc">|&gt;</span> <span class="fu">View</span>()</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">setdiff</span>(cli4, cli2) <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind(cli2[idx == "01OV007"],</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co">#       cli4[idx == "01OV007"]) |&gt; View()</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 个数据源目录的文件基本没有区别</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>cli.final <span class="ot">=</span> cli2 <span class="sc">|&gt;</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">Patient_ID =</span> idx,</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Status =</span> OS_event,</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Time =</span> OS_days,</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">PFS_Status =</span> PFS_event,</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">PFS_Time =</span> PFS_days</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sample_ID =</span> Patient_ID,</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sex =</span> <span class="fu">ifelse</span>(Sex <span class="sc">==</span> <span class="st">"Female"</span>, <span class="st">"F"</span>, <span class="st">"M"</span>)</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    Patient_ID, Sample_ID, Cancer, Age, Sex, OS_Time, OS_Status, PFS_Time, PFS_Status, dplyr<span class="sc">::</span><span class="fu">everything</span>()</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::select(</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   - dplyr::starts_with("CIBERSORT"), - dplyr::starts_with("xCell")</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(cli.final, <span class="at">file =</span> <span class="st">"CPTAC_cli_paper_combined.tsv"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Clinical data from GDC --------------------------------------------------</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">"</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="st">cd /home/data2/Projects/Fusion/unclean/gdc_cli/CPTAC</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="st">mkdir CPTAC-3 CPTAC-2</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="st">tar zxvf clinical.project-cptac-2.2024-08-07.tar.gz -C CPTAC-2</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="st">tar zxvf clinical.project-cptac-3.2024-08-07.tar.gz -C CPTAC-3</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="st">       "</span>)</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>cptac2 <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">"gdc_cli/CPTAC/CPTAC-2/clinical.tsv"</span>)</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>cptac3 <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">"gdc_cli/CPTAC/CPTAC-3/clinical.tsv"</span>)</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(<span class="fu">colnames</span>(cptac2) <span class="sc">%in%</span> <span class="st">"residual_disease"</span>)</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(<span class="fu">colnames</span>(cptac3) <span class="sc">%in%</span> <span class="st">"residual_disease"</span>)</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(cptac2[[<span class="dv">119</span>]], cptac2[[<span class="dv">192</span>]])</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(cptac3[[<span class="dv">119</span>]], cptac3[[<span class="dv">192</span>]])</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>cptac2[[<span class="dv">192</span>]] <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>cptac3[[<span class="dv">192</span>]] <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(cptac2<span class="sc">$</span>case_submitter_id, cli.final<span class="sc">$</span>Sample_ID)</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(cptac3<span class="sc">$</span>case_submitter_id, cli.final<span class="sc">$</span>Sample_ID)</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; setdiff(cptac2$case_submitter_id, cli.final$Sample_ID)</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] "01OV049"   "26OV010"   "100004028" "05BR058"   "05BR055"   "17OV019"   "11BR069"   "02OV042"   "100004012" "05BR051"   "03BR012"   "02OV045"   "04OV041"</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="co"># [14] "05BR052"   "05BR031"   "1488"      "11OV009"   "02OV040"   "01OV002"   "100002921" "22OV001"   "13OV004"   "100003304" "02OV035"   "01OV046"   "01OV045"</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="co"># [27] "17OV034"</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt; setdiff(cptac3$case_submitter_id, cli.final$Sample_ID)</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] "C3N-02672"                    "C3L-01929"                    "C3N-02682"                    "C3N-02012"                    "C3N-02070"</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="co"># [6] "C3N-02696"                    "C3L-02354"                    "C3N-03026"                    "C3L-01739"                    "C3N-02088"</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="co"># [11] "C3L-04213"                    "C3N-03205"                    "C3L-04081"                    "C3N-03791"                    "C3L-03679"</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="co"># [16] "C3L-02643"                    "C3N-04686"                    "C3L-01558"                    "C3L-03268"                    "C3L-01633"</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="co"># [21] "C3L-02220"                    "C3N-02439"                    "C3N-02028"                    "C3N-03800"                    "C3L-04392"</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="co"># [26] "C3L-02556"                    "C3N-02721"                    "C3L-01672"                    "C3L-00938"                    "C3L-02201"</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="co"># [31] "C3N-02146"                    "C3N-02639"                    "C3N-03788"                    "C3L-03733"                    "C3L-04037"</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="co"># [36] "C3N-01091"                    "C3L-02747"                    "C3N-01879"                    "C3N-02996"                    "C3N-02296"</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a><span class="co"># [41] "C3L-02553"                    "C3L-03632"                    "C3N-03755"                    "GTEX-NPJ7-0011-R10A-SM-HAKXW" "C3L-02746"</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">setdiff</span>(cptac3<span class="sc">$</span>case_submitter_id, cli.final<span class="sc">$</span>Sample_ID))  <span class="co"># 586</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(cptac2[case_submitter_id <span class="sc">%in%</span> <span class="fu">setdiff</span>(cptac2<span class="sc">$</span>case_submitter_id, cli.final<span class="sc">$</span>Sample_ID)])</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(cptac3[case_submitter_id <span class="sc">%in%</span> <span class="fu">setdiff</span>(cptac3<span class="sc">$</span>case_submitter_id, cli.final<span class="sc">$</span>Sample_ID)])</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">fwrite</span>(</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>  cptac3[case_submitter_id <span class="sc">%in%</span> <span class="fu">setdiff</span>(cptac3<span class="sc">$</span>case_submitter_id, cli.final<span class="sc">$</span>Sample_ID)],</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"CPTAC3_non_included.tsv"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>cptac3</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据 GDC 已有信息补全 paper 缺少的样本信息 ---------------------------------------------</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a><span class="co"># 可能标记了 cancer type 的列</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="co"># primary_diagnosis site_of_resection_or_biopsy tissue_or_organ_of_origin</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>cptac <span class="ot">=</span> <span class="fu">rbind</span>(cptac2, cptac3)[, .(case_submitter_id, primary_diagnosis, site_of_resection_or_biopsy, tissue_or_organ_of_origin)] <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>cptac <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(cptac, cli.final[, .(Sample_ID, Cancer)], <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"case_submitter_id"</span><span class="ot">=</span><span class="st">"Sample_ID"</span>))</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(cli.final<span class="sc">$</span>Sample_ID, cptac<span class="sc">$</span>case_submitter_id)</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="co"># 有 29 例不在 GDC 数据中</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cptac<span class="sc">$</span>Cancer, cptac<span class="sc">$</span>primary_diagnosis) <span class="sc">|&gt;</span> pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>()</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cptac<span class="sc">$</span>Cancer, cptac<span class="sc">$</span>site_of_resection_or_biopsy) <span class="sc">|&gt;</span> pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>()</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cptac<span class="sc">$</span>Cancer, cptac<span class="sc">$</span>tissue_or_organ_of_origin) <span class="sc">|&gt;</span> pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>()</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cptac<span class="sc">$</span>Cancer,</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>        cptac<span class="sc">$</span>primary_diagnosis,</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>        cptac<span class="sc">$</span>site_of_resection_or_biopsy,</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>        cptac<span class="sc">$</span>tissue_or_organ_of_origin, <span class="at">sep =</span> <span class="st">"_"</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>      )) <span class="sc">|&gt;</span> pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(<span class="at">show_colnames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a><span class="co"># 一个个处理</span></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sub</span>(<span class="st">"_meta.txt"</span>, <span class="st">""</span>, <span class="fu">basename</span>(<span class="fu">names</span>(cli_list))))</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>typelist <span class="ot">=</span> <span class="fu">sub</span>(<span class="st">"_meta.txt"</span>, <span class="st">""</span>, <span class="fu">basename</span>(<span class="fu">names</span>(cli_list)))</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a><span class="co"># BRCA CCRCC COAD GBM HGSC HNSCC LSCC LUAD PDAC UCEC</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> typelist) {</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"check type "</span>, i)</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>  cptac_part <span class="ot">=</span> cptac <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Cancer <span class="sc">==</span> i)</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"  primary_diagnosis"</span>)</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(cptac_part<span class="sc">$</span>Cancer, cptac_part<span class="sc">$</span>primary_diagnosis) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"  site_of_resection_or_biopsy"</span>)</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(cptac_part<span class="sc">$</span>Cancer, cptac_part<span class="sc">$</span>site_of_resection_or_biopsy) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"  tissue_or_organ_of_origin"</span>)</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(cptac_part<span class="sc">$</span>Cancer, cptac_part<span class="sc">$</span>tissue_or_organ_of_origin) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a><span class="co"># BRCA (122): tissue_or_organ_of_origin "Breast, NOS"</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a><span class="co"># CCRCC (103): primary_diagnosis "Renal cell carcinoma, NOS"</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a><span class="co">#        tissue_or_organ_of_origin "Kidney, NOS"</span></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a><span class="co"># COAD (106): tissue_or_organ_of_origin "Colon, NOS", "Rectum, NOS"</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a><span class="co"># GBM (99): primary_diagnosis "Glioblastoma"</span></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a><span class="co"># HGSC (87): primary_diagnosis "Serous adenocarcinoma, NOS" AND</span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a><span class="co">#  tissue_or_organ_of_origin Fallopian tube Ovary Peritoneum, NOS</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a><span class="co"># HNSCC (108): 其他情况 primary_diagnosis "Squamous cell carcinoma, NOS"</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Base of tongue, NOS Cheek mucosa Floor of mouth, NOS Gum, NOS</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a><span class="co"># HNSCC                   1            2                  18        3</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a><span class="co"># Head, face or neck, NOS Larynx, NOS Lip, NOS Oropharynx, NOS</span></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a><span class="co"># HNSCC                       2          47        4               4</span></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a><span class="co"># Overlapping lesion of lip, oral cavity and pharynx Tongue, NOS Tonsil, NOS</span></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a><span class="co"># HNSCC</span></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a><span class="co"># LSCC (108): primary_diagnosis "Squamous cell carcinoma, NOS" AND</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a><span class="co">#   tissue_or_organ_of_origin "lung" pattern</span></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a><span class="co"># LUAD (110): primary_diagnosis "Adenocarcinoma, NOS" AND</span></span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a><span class="co">#   tissue_or_organ_of_origin "lung" pattern</span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a><span class="co"># PDAC (105): tissue_or_organ_of_origin "pancreas" pattern</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a><span class="co"># UCEC (95): primary_diagnosis "Endometrioid adenocarcinoma, NOS"</span></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(cptac<span class="sc">$</span>Cancer))</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind(cptac2, cptac3)[,192] # 有重复列，需要回到前面处理 (fixed)</span></span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a><span class="co"># 实际测试和更新</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>cptac_updated <span class="ot">=</span> <span class="fu">rbind</span>(cptac2, cptac3) <span class="sc">|&gt;</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cancer =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>      tissue_or_organ_of_origin <span class="sc">%in%</span> <span class="st">"Breast, NOS"</span> <span class="sc">~</span> <span class="st">"BRCA"</span>,</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>      primary_diagnosis <span class="sc">%in%</span> <span class="st">"Renal cell carcinoma, NOS"</span> <span class="sc">~</span> <span class="st">"CCRCC"</span>,</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>      tissue_or_organ_of_origin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Colon, NOS"</span>, <span class="st">"Rectum, NOS"</span>) <span class="sc">~</span> <span class="st">"COAD"</span>,</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"Glioblastoma"</span>, primary_diagnosis, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">"Oligodendroglioma"</span>, primary_diagnosis, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"GBM"</span>,</span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"GTEX"</span>, case_submitter_id, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"GTEX-Brain"</span>,</span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>      case_submitter_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"C3L-06912"</span>, <span class="st">"C3L-07212"</span>) <span class="sc">~</span> <span class="st">"GBM"</span>,</span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>      <span class="co">#primary_diagnosis %in% "Glioblastoma" ~ "GBM",</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>      primary_diagnosis <span class="sc">%in%</span> <span class="st">"Serous adenocarcinoma, NOS"</span> <span class="sc">&amp;</span> tissue_or_organ_of_origin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Fallopian tube"</span>, <span class="st">"Ovary"</span>, <span class="st">"Peritoneum, NOS"</span>) <span class="sc">~</span> <span class="st">"HGSC"</span>,</span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>      primary_diagnosis <span class="sc">%in%</span> <span class="st">"Squamous cell carcinoma, NOS"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"lung"</span>, tissue_or_organ_of_origin, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"LSCC"</span>,</span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>      primary_diagnosis <span class="sc">%in%</span> <span class="st">"Adenocarcinoma, NOS"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"lung"</span>, tissue_or_organ_of_origin, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"LUAD"</span>,</span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"pancreas"</span>, tissue_or_organ_of_origin, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"PDAC"</span>,</span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>      primary_diagnosis <span class="sc">%in%</span> <span class="st">"Endometrioid adenocarcinoma, NOS"</span> <span class="sc">~</span> <span class="st">"UCEC"</span>,</span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"HNSCC"</span></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">as.data.table</span>()</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="st">"HNSCC"</span>) { <span class="co"># typelist</span></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"check type "</span>, i)</span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>  cptac_part <span class="ot">=</span> cptac_updated <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Cancer <span class="sc">==</span> i)</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"  primary_diagnosis"</span>)</span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(cptac_part<span class="sc">$</span>Cancer, cptac_part<span class="sc">$</span>primary_diagnosis) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"  site_of_resection_or_biopsy"</span>)</span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(cptac_part<span class="sc">$</span>Cancer, cptac_part<span class="sc">$</span>site_of_resection_or_biopsy) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"  tissue_or_organ_of_origin"</span>)</span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(cptac_part<span class="sc">$</span>Cancer, cptac_part<span class="sc">$</span>tissue_or_organ_of_origin) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cptac<span class="sc">$</span>Cancer)</span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cptac_updated<span class="sc">$</span>Cancer)</span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>cptac_updated <span class="sc">|&gt;</span></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>    primary_diagnosis <span class="sc">==</span> <span class="st">"'--"</span> <span class="sc">|</span> site_of_resection_or_biopsy <span class="sc">==</span> <span class="st">"'--"</span> <span class="sc">|</span></span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>    tissue_or_organ_of_origin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"'--"</span>, <span class="st">"Unknown"</span>)</span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a><span class="co"># 1-9 from GTEX-Brain</span></span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a><span class="co"># C3L-06912 C3L-07212 Gliomas # https://portal.gdc.cancer.gov/cases/e6027623-a5b2-4d82-a9ca-f37c948dd3ed</span></span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>cptac_updated<span class="sc">$</span>case_submitter_id[<span class="fu">grepl</span>(<span class="st">"GTEX"</span>, cptac_updated<span class="sc">$</span>case_submitter_id)]</span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(cptac_updated)</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(cptac_updated, <span class="at">file =</span> <span class="st">"CPTAC_combined_with_cancer_annotated.tsv"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>cptac_unmatched <span class="ot">=</span> cptac_updated[<span class="sc">!</span> case_submitter_id <span class="sc">%in%</span> cli.final<span class="sc">$</span>Sample_ID]</span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cptac_unmatched)</span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cli.final)[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>cptac_unmatched2 <span class="ot">=</span> cptac_unmatched <span class="sc">|&gt;</span></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>    case_submitter_id, age_at_diagnosis, gender,</span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>    days_to_death, vital_status,</span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">"ajcc"</span>),</span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">"days"</span>),</span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>    last_known_disease_status, progression_or_recurrence, residual_disease,</span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>    tumor_grade, Cancer</span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(cptac_unmatched2<span class="sc">$</span>days_to_last_follow_up <span class="sc">!=</span> <span class="st">"'--"</span>)</span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(cptac_unmatched2<span class="sc">$</span>days_to_death <span class="sc">!=</span> <span class="st">"'--"</span>)</span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(cptac_unmatched2<span class="sc">$</span>days_to_recurrence <span class="sc">!=</span> <span class="st">"'--"</span>)</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(cptac_unmatched2<span class="sc">$</span>days_to_last_known_disease_status <span class="sc">!=</span> <span class="st">"'--"</span>)</span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(cptac_unmatched2<span class="sc">$</span>progression_or_recurrence <span class="sc">!=</span> <span class="st">"'--"</span>)</span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(cli.final<span class="sc">$</span>OS_Time))</span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(cli.final<span class="sc">$</span>PFS_Time))</span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(cli.final<span class="sc">$</span>OS_Time <span class="sc">&gt;=</span> cli.final<span class="sc">$</span>PFS_Time, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>cli.final[cli.final<span class="sc">$</span>OS_Time <span class="sc">&lt;</span> cli.final<span class="sc">$</span>PFS_Time] <span class="sc">|&gt;</span> <span class="fu">View</span>()</span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">as.integer</span>(cptac_unmatched2<span class="sc">$</span>days_to_last_follow_up) <span class="sc">&gt;=</span> <span class="fu">as.integer</span>(cptac_unmatched2<span class="sc">$</span>days_to_last_known_disease_status), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>cptac_unmatched3 <span class="ot">=</span> cptac_unmatched2 <span class="sc">|&gt;</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sample_ID =</span> case_submitter_id,</span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age =</span> age_at_diagnosis,</span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sex =</span> gender,</span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Time =</span> days_to_last_follow_up,</span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Status =</span> vital_status,</span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>    <span class="at">PFS_Time =</span> days_to_last_known_disease_status,</span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>    <span class="at">PFS_Status =</span> progression_or_recurrence,</span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>    <span class="at">Histologic_Grade =</span> tumor_grade,</span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>    <span class="at">Path_Stage_pT =</span> ajcc_pathologic_t,</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>    <span class="at">Path_Stage_pN =</span> ajcc_pathologic_n,</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>    <span class="at">Stage =</span> ajcc_pathologic_stage</span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>    Sample_ID, Age, Sex, OS_Time, OS_Status, PFS_Time, PFS_Status,</span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a>    Path_Stage_pN<span class="sc">:</span>Path_Stage_pT,</span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>    Histologic_Grade, Cancer</span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>    <span class="at">Patient_ID =</span> Sample_ID,</span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age =</span> <span class="fu">as.integer</span>(<span class="fu">round</span>(<span class="fu">as.integer</span>(Age) <span class="sc">/</span> <span class="dv">365</span>)),</span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sex =</span> <span class="fu">fcase</span>(Sex <span class="sc">%in%</span> <span class="st">"female"</span>, <span class="st">"F"</span>,</span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>                Sex <span class="sc">%in%</span> <span class="st">"male"</span>, <span class="st">"M"</span>, <span class="at">default =</span> <span class="cn">NA_character_</span>),</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Time =</span> <span class="fu">as.integer</span>(OS_Time),</span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Status =</span> <span class="fu">fcase</span>(OS_Status <span class="sc">%in%</span> <span class="st">"Alive"</span>, <span class="dv">0</span>L,</span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>                      OS_Status <span class="sc">%in%</span> <span class="st">"Dead"</span>, <span class="dv">1</span>L, <span class="at">default =</span> <span class="cn">NA_integer_</span>),</span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>    <span class="at">PFS_Time =</span> <span class="fu">as.integer</span>(PFS_Time),</span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>    <span class="at">PFS_Status =</span> <span class="fu">fcase</span>(PFS_Status <span class="sc">%in%</span> <span class="st">"no"</span>, <span class="dv">0</span>L,</span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>                       PFS_Status <span class="sc">%in%</span> <span class="st">"yes"</span>, <span class="dv">1</span>L, <span class="at">default =</span> <span class="cn">NA_integer_</span>),</span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Time =</span> <span class="fu">ifelse</span>(OS_Time <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">NA_integer_</span>, OS_Time),</span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">Path_Stage_pN =</span> <span class="fu">fcase</span>(</span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a>      Path_Stage_pN <span class="sc">%in%</span> <span class="st">"N0"</span>, <span class="st">"pN0"</span>,</span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>      Path_Stage_pN <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"N1"</span>, <span class="st">"N1a"</span>), <span class="st">"pN1"</span>,</span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>      Path_Stage_pN <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"N2"</span>, <span class="st">"N2a"</span>), <span class="st">"pN2"</span>,</span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>      <span class="at">default =</span> <span class="cn">NA_character_</span></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>    <span class="at">Path_Stage_pT =</span> <span class="fu">fcase</span>(</span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>      Path_Stage_pT <span class="sc">%in%</span> <span class="st">"T0"</span>, <span class="st">"pT0"</span>,</span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>      Path_Stage_pT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"T1"</span>, <span class="st">"T1a"</span>, <span class="st">"T1b"</span>, <span class="st">"T1c"</span>), <span class="st">"pT1"</span>,</span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>      Path_Stage_pT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"T2"</span>, <span class="st">"T2a"</span>, <span class="st">"T2b"</span>), <span class="st">"pT2"</span>,</span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>      Path_Stage_pT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"T3"</span>, <span class="st">"T3a"</span>, <span class="st">"T3b"</span>), <span class="st">"pT3"</span>,</span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>      Path_Stage_pT <span class="sc">%in%</span> <span class="st">"T4"</span>, <span class="st">"pT4"</span>,</span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>      <span class="at">default =</span> <span class="cn">NA_character_</span></span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>    <span class="at">Stage =</span> <span class="fu">fcase</span>(</span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>      Stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Stage I"</span>, <span class="st">"Stage IA"</span>, <span class="st">"Stage IA1"</span>, <span class="st">"Stage IA2"</span>, <span class="st">"Stage IA3"</span>, <span class="st">"Stage IB"</span>), <span class="st">"Stage I"</span>,</span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>      Stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Stage II"</span>, <span class="st">"Stage IIA"</span>, <span class="st">"Stage IIB"</span>), <span class="st">"Stage II"</span>,</span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>      Stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Stage III"</span>, <span class="st">"Stage IIIA"</span>, <span class="st">"Stage IIIB"</span>, <span class="st">"Stage IIIC"</span>, <span class="st">"Stage IIIC1"</span>, <span class="st">"Stage IIIC2"</span>), <span class="st">"Stage III"</span>,</span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>      Stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Stage IV"</span>, <span class="st">"Stage IVB"</span>), <span class="st">"Stage IV"</span>,</span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>      <span class="at">default =</span> <span class="cn">NA_character_</span></span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>    <span class="at">Histologic_Grade =</span> <span class="fu">fcase</span>(</span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>      Histologic_Grade <span class="sc">%in%</span> <span class="st">"G1"</span>, <span class="st">"G1 Well differentiated"</span>,</span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>      Histologic_Grade <span class="sc">%in%</span> <span class="st">"G2"</span>, <span class="st">"G2 Moderately differentiated"</span>,</span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>      Histologic_Grade <span class="sc">%in%</span> <span class="st">"G3"</span>, <span class="st">"G3 Poorly differentiated"</span>,</span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>      Histologic_Grade <span class="sc">%in%</span> <span class="st">"G4"</span>, <span class="st">"G4 Undifferentiated"</span>,</span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>      <span class="at">default =</span> <span class="cn">NA_character_</span></span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>cptac_unmatched3</span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a><span class="co"># X: cannot be assessed</span></span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cptac_unmatched3<span class="sc">$</span>Path_Stage_pN)</span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cli.final<span class="sc">$</span>Path_Stage_pN)</span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cptac_unmatched3<span class="sc">$</span>Path_Stage_pT)</span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cli.final<span class="sc">$</span>Path_Stage_pT)</span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cptac_unmatched3<span class="sc">$</span>Stage)</span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cli.final<span class="sc">$</span>Stage)</span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cptac_unmatched3<span class="sc">$</span>Histologic_Grade)</span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cli.final<span class="sc">$</span>Histologic_Grade)</span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a><span class="co"># Final output ------------------------------------------------------------</span></span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a>cli.final<span class="fl">.2</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a>  cli.final, cptac_unmatched3</span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">as.data.table</span>()</span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cli.final<span class="fl">.2</span><span class="sc">$</span>Cancer)</span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">table</span>(cli.final<span class="fl">.2</span><span class="sc">$</span>Cancer))</span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a><span class="co"># Race 全部加进去？</span></span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a>cli.final<span class="fl">.2</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a>  cli.final<span class="fl">.2</span>, <span class="fu">unique</span>(<span class="fu">rbind</span>(cptac2, cptac3)[, .(case_submitter_id, race)]),</span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Sample_ID"</span><span class="ot">=</span><span class="st">"case_submitter_id"</span>)</span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>    <span class="at">race =</span> <span class="fu">ifelse</span>(race <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Unknown"</span>, <span class="st">"not reported"</span>), <span class="cn">NA_character_</span>,</span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a>                  race)</span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.table</span>()</span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(cli.final<span class="fl">.2</span><span class="sc">$</span>race))</span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(cli.final<span class="fl">.2</span>, <span class="at">file =</span> <span class="st">"/home/data2/Projects/Fusion/fusiondb/Clininfo/CPTAC_info.tsv"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="target" class="level3">
<h3 class="anchored" data-anchor-id="target">TARGET</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>cli1 <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">"TARGET_donor_allprojects_transfer_to_sample.gz"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>cli2 <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">"TARGET_phenotype.gz"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>target_cli <span class="ot">=</span> cli2 <span class="sc">|&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">_cohort</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Patient_ID =</span> <span class="st">`</span><span class="at">_PATIENT</span><span class="st">`</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">Sample_ID =</span> sample_id,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">disease_code =</span> primary_disease_code,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">disease =</span> <span class="st">`</span><span class="at">_primary_disease</span><span class="st">`</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">sample_type =</span> <span class="st">`</span><span class="at">_sample_type</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">full_join</span>(</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    cli1 <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span><span class="st">`</span><span class="at">_OS_UNIT</span><span class="st">`</span>, <span class="sc">-</span><span class="st">`</span><span class="at">_EVENT</span><span class="st">`</span>, <span class="sc">-</span><span class="st">`</span><span class="at">_TIME_TO_EVENT</span><span class="st">`</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">Sample_ID =</span> xena_sample,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">Sex =</span> <span class="st">`</span><span class="at">_gender</span><span class="st">`</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">Age =</span> <span class="st">`</span><span class="at">_age_at_diagnosis</span><span class="st">`</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">OS_Status =</span> <span class="st">`</span><span class="at">_OS_IND</span><span class="st">`</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">OS_Time =</span> <span class="st">`</span><span class="at">_OS</span><span class="st">`</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>      ), <span class="at">by =</span> <span class="st">"Sample_ID"</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sex =</span> <span class="fu">ifelse</span>(Sex <span class="sc">==</span> <span class="st">"Male"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Status =</span> <span class="fu">ifelse</span>(OS_Status <span class="sc">==</span> <span class="st">"Alive"</span>, <span class="dv">0</span>L, <span class="dv">1</span>L)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Patient_ID, Sample_ID, Age, Sex, OS_Time, OS_Status, dplyr<span class="sc">::</span><span class="fu">everything</span>()) <span class="sc">|&gt;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.table</span>()</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>cli1</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>target_cli</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(target_cli, <span class="at">file =</span> <span class="st">"/home/data2/Projects/Fusion/fusiondb/Clininfo/TARGET_xena_info.tsv"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Using cli from GDC ------------------------------------------------------</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">"</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="st">cd /home/data2/Projects/Fusion/unclean/gdc_cli/TARGET</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="st">mkdir ALL_P1 ALL_P2 ALL_P3 AML CCSK NBL OS RT WT</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="st">tar zxvf clinical.project-target-all-p1.2024-08-07.tar.gz -C ALL_P1</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="st">tar zxvf clinical.project-target-all-p2.2024-08-07.tar.gz -C ALL_P2</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="st">tar zxvf clinical.project-target-all-p3.2024-08-07.tar.gz -C ALL_P3</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="st">tar zxvf clinical.project-target-aml.2024-08-07.tar.gz -C AML</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="st">tar zxvf clinical.project-target-ccsk.2024-08-07.tar.gz -C CCSK</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="st">tar zxvf clinical.project-target-nbl.2024-08-07.tar.gz -C NBL</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="st">tar zxvf clinical.project-target-os.2024-08-07.tar.gz -C OS</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="st">tar zxvf clinical.project-target-rt.2024-08-07.tar.gz -C RT</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="st">tar zxvf clinical.project-target-wt.2024-08-07.tar.gz -C WT</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="st">       "</span>)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>gdc_target <span class="ot">=</span> <span class="fu">rbindlist</span>(</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fread</span>(<span class="st">"gdc_cli/TARGET/ALL_P1/clinical.tsv"</span>),</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fread</span>(<span class="st">"gdc_cli/TARGET/ALL_P2/clinical.tsv"</span>),</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fread</span>(<span class="st">"gdc_cli/TARGET/ALL_P3/clinical.tsv"</span>),</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fread</span>(<span class="st">"gdc_cli/TARGET/AML/clinical.tsv"</span>),</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fread</span>(<span class="st">"gdc_cli/TARGET/CCSK/clinical.tsv"</span>),</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fread</span>(<span class="st">"gdc_cli/TARGET/NBL/clinical.tsv"</span>),</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fread</span>(<span class="st">"gdc_cli/TARGET/OS/clinical.tsv"</span>),</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fread</span>(<span class="st">"gdc_cli/TARGET/RT/clinical.tsv"</span>),</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fread</span>(<span class="st">"gdc_cli/TARGET/WT/clinical.tsv"</span>)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">use.names =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(gdc_target<span class="sc">$</span>project_id)</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(gdc_target))</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>gdc_target <span class="ot">=</span> gdc_target[<span class="sc">!</span><span class="fu">duplicated</span>(gdc_target)]</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(gdc_target[[<span class="dv">119</span>]], gdc_target[[<span class="dv">192</span>]])</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>gdc_target[[<span class="dv">192</span>]] <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(gdc_target<span class="sc">$</span>days_to_last_follow_up <span class="sc">!=</span> <span class="st">"'--"</span>)</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(gdc_target<span class="sc">$</span>days_to_death <span class="sc">!=</span> <span class="st">"'--"</span>)</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>gdc_target2 <span class="ot">=</span> gdc_target <span class="sc">|&gt;</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sample_ID =</span> case_submitter_id,</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age =</span> age_at_diagnosis,</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sex =</span> gender,</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Time =</span> days_to_death,</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Status =</span> vital_status</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    Sample_ID, Age, Sex, OS_Time, OS_Status,</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    project_id, race, primary_diagnosis</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">Patient_ID =</span> Sample_ID,</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age =</span> <span class="fu">as.integer</span>(<span class="fu">round</span>(<span class="fu">as.integer</span>(Age) <span class="sc">/</span> <span class="dv">365</span>)),</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sex =</span> <span class="fu">fcase</span>(Sex <span class="sc">%in%</span> <span class="st">"female"</span>, <span class="st">"F"</span>,</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>                Sex <span class="sc">%in%</span> <span class="st">"male"</span>, <span class="st">"M"</span>, <span class="at">default =</span> <span class="cn">NA_character_</span>),</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Time =</span> <span class="fu">as.integer</span>(OS_Time),</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Status =</span> <span class="fu">fcase</span>(OS_Status <span class="sc">%in%</span> <span class="st">"Alive"</span>, <span class="dv">0</span>L,</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>                      OS_Status <span class="sc">%in%</span> <span class="st">"Dead"</span>, <span class="dv">1</span>L, <span class="at">default =</span> <span class="cn">NA_integer_</span>),</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">OS_Time =</span> <span class="fu">ifelse</span>(OS_Time <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">NA_integer_</span>, OS_Time)</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.table</span>()</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a><span class="co">#unique()</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a><span class="co"># 存在大量 case level 重复</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>gdc_target2[<span class="fu">duplicated</span>(gdc_target2), ]</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="fu">duplicated</span>(gdc_target[case_submitter_id <span class="sc">==</span> <span class="st">"TARGET-20-PANTIV"</span>])</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>gdc_target[case_submitter_id <span class="sc">==</span> <span class="st">"TARGET-20-PANTIV"</span>] <span class="sc">|&gt;</span> <span class="fu">View</span>() <span class="co"># 存在少量记录的更新？</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>gdc_target2 <span class="ot">=</span> gdc_target2[<span class="sc">!</span><span class="fu">duplicated</span>(gdc_target2)]</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a><span class="co">#table(gdc_target2$PFS_Time)</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(gdc_target2))</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(gdc_target2<span class="sc">$</span>Sample_ID))</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>gdc_target2[<span class="fu">duplicated</span>(gdc_target2<span class="sc">$</span>Sample_ID)]</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a><span class="co"># 会存在不同 ALL 的 Project 中</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>gdc_dup <span class="ot">=</span> gdc_target2[Sample_ID <span class="sc">%in%</span> Sample_ID[<span class="fu">duplicated</span>(Sample_ID)]]</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(gdc_dup<span class="sc">$</span>project_id)</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a><span class="co"># TARGET-ALL-P1 TARGET-ALL-P2 TARGET-ALL-P3</span></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a><span class="co"># 10            57            47</span></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a><span class="co"># 这种先不处理，如果 ALL 合并分析考虑去重</span></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gdc_target2)</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>gdc_target2 <span class="ot">=</span> gdc_target2[, <span class="fu">c</span>(<span class="st">"Patient_ID"</span>, <span class="st">"Sample_ID"</span>, <span class="st">"Age"</span>, <span class="st">"Sex"</span>, <span class="st">"race"</span>, <span class="st">"primary_diagnosis"</span>, <span class="st">"OS_Time"</span>, <span class="st">"OS_Status"</span>, <span class="st">"project_id"</span>)]</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(gdc_target2, <span class="at">file =</span> <span class="st">"/home/data2/Projects/Fusion/fusiondb/Clininfo/TARGET_info.tsv"</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(gdc_target2<span class="sc">$</span>OS_Time))</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(cli1<span class="sc">$</span><span class="st">`</span><span class="at">_OS</span><span class="st">`</span>))</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">na.omit</span>(<span class="fu">unique</span>(target_cli[, .(Patient_ID, OS_Time, OS_Status)])))</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(<span class="fu">na.omit</span>(<span class="fu">unique</span>(gdc_target2[, .(Patient_ID, OS_Time, OS_Status)])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/OncoHarmony-Network\.github\.io\/doc-immunofusion\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>